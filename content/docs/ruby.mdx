---
title: "Ruby"
description: "Using Ruby in Elide with TruffleRuby"
date: "2025-11-20"
---

# Ruby

Run Ruby code in Elide powered by TruffleRuby for high performance.

## Overview

Elide supports Ruby 3.2+ through TruffleRuby, providing:

- Full Ruby language support
- High performance execution
- Polyglot interoperability
- Native gem support (pure Ruby)

## Quick Start

```ruby
# hello.rb
puts "Hello from Ruby in Elide!"

# Variables
name = "Elide"
version = "1.0"
puts "#{name} version #{version}"

# Arrays and iteration
[1, 2, 3, 4, 5].each do |n|
  puts n * 2
end
```

Run it:

```bash
elide run hello.rb
```

## Ruby Features

### Classes and Modules

```ruby
# person.rb
class Person
  attr_accessor :name, :age
  
  def initialize(name, age)
    @name = name
    @age = age
  end
  
  def greet
    "Hello, I'm #{@name} and I'm #{@age} years old"
  end
end

person = Person.new("Alice", 30)
puts person.greet
```

### Blocks and Procs

```ruby
# Blocks
[1, 2, 3].map { |n| n * 2 }

# Procs
square = Proc.new { |x| x * x }
puts square.call(5) # 25

# Lambdas
multiply = ->(x, y) { x * y }
puts multiply.call(3, 4) # 12
```

### Metaprogramming

```ruby
class DynamicClass
  def method_missing(method, *args)
    puts "Called #{method} with #{args.join(', ')}"
  end
  
  def respond_to_missing?(method, include_private = false)
    true
  end
end

obj = DynamicClass.new
obj.anything(1, 2, 3) # Works!
```

## File I/O

```ruby
# Read file
content = File.read('data.txt')

# Write file
File.write('output.txt', 'Hello, World!')

# Read lines
File.readlines('data.txt').each do |line|
  puts line
end

# With block
File.open('data.txt', 'r') do |file|
  file.each_line do |line|
    puts line
  end
end
```

## HTTP Requests

### Using Net::HTTP

```ruby
require 'net/http'
require 'json'

uri = URI('https://api.example.com/data')
response = Net::HTTP.get(uri)
data = JSON.parse(response)

puts data['key']
```

### POST Requests

```ruby
require 'net/http'
require 'json'

uri = URI('https://api.example.com/users')
req = Net::HTTP::Post.new(uri, 'Content-Type' => 'application/json')
req.body = { name: 'Alice', age: 30 }.to_json

res = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) do |http|
  http.request(req)
end

puts res.body
```

## Polyglot Interop

### Calling JavaScript from Ruby

```ruby
# Call JavaScript
result = Polyglot.eval('js', '[1, 2, 3].map(x => x * 2)')
puts result.inspect # [2, 4, 6]

# Import JavaScript module
fs = Polyglot.import('fs')
content = fs.readFileSync('data.txt', 'utf8')
```

### Calling Ruby from JavaScript

```javascript
// Evaluate Ruby code
const result = Polyglot.eval('ruby', '5 + 3')
console.log(result) // 8

// Call Ruby methods
const ruby = Polyglot.eval('ruby', `
  class Calculator
    def add(a, b)
      a + b
    end
  end
  Calculator.new
`)

console.log(ruby.add(5, 3)) // 8
```

## Gems

### Pure Ruby Gems

Most pure Ruby gems work out of the box:

```bash
# Install gem
gem install json
gem install httparty
```

```ruby
require 'json'
require 'httparty'

response = HTTParty.get('https://api.example.com/data')
data = JSON.parse(response.body)
```

### Native Extension Gems

Gems with C extensions may have limited support. Prefer pure Ruby alternatives when possible.

| Gem | Status |
|-----|--------|
| `json` | ✅ Supported |
| `nokogiri` | ⚠️ Partial |
| `pg` | ⚠️ Partial |
| `sqlite3` | ⚠️ Partial |

## Performance

TruffleRuby provides excellent performance:

| Benchmark | MRI | TruffleRuby |
|-----------|-----|-------------|
| **Startup** | 1.0x | 1.2x |
| **Warmup** | 1.0x | 10-20x |
| **Peak** | 1.0x | 20-50x |

## Best Practices

1. **Warmup**: Performance improves after warmup period
2. **Pure Ruby**: Prefer pure Ruby over C extensions
3. **Idiomatic code**: Write idiomatic Ruby for best performance
4. **Profile**: Use profiling to find bottlenecks

## Example: Web Scraper

```ruby
require 'net/http'
require 'json'

class WebScraper
  def initialize(url)
    @url = URI(url)
  end
  
  def fetch
    response = Net::HTTP.get(@url)
    parse(response)
  end
  
  private
  
  def parse(html)
    # Simple parsing (use Nokogiri for real scraping)
    html.scan(/<title>(.*?)<\/title>/).flatten
  end
end

scraper = WebScraper.new('https://example.com')
titles = scraper.fetch
puts titles
```

## Example: Data Processing

```ruby
# Process CSV data
data = [
  { name: 'Alice', score: 85 },
  { name: 'Bob', score: 92 },
  { name: 'Charlie', score: 78 }
]

# Calculate average
average = data.map { |row| row[:score] }.sum / data.length.to_f
puts "Average: #{average}"

# Filter and sort
top_scorers = data
  .select { |row| row[:score] > 80 }
  .sort_by { |row| -row[:score] }

top_scorers.each do |person|
  puts "#{person[:name]}: #{person[:score]}"
end
```

## Debugging

```ruby
# Use binding.pry for debugging (if available)
require 'pry'

def complex_method(x)
  y = x * 2
  binding.pry # Breakpoint
  y + 10
end

# Or use basic puts debugging
def debug_method(x)
  puts "Input: #{x.inspect}"
  result = x * 2
  puts "After multiply: #{result.inspect}"
  result
end
```

## Limitations

Current limitations:

- C extension support is limited
- Some Ruby gems may not work
- Threading has some restrictions
- Fork is not available in native image

## Resources

- [TruffleRuby Documentation](https://github.com/oracle/truffleruby)
- [Ruby Documentation](https://ruby-doc.org/)
- [Ruby Style Guide](https://rubystyle.guide/)

